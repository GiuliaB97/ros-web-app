<html>

	<head>
		<script
				type="text/javascript" src="https://static.robotwebtools.org/roslibjs/current/roslib.min.js">
		</script>
		<script
				src="https://cdn.jsdelivr.net/npm/eventemitter2@5.0.1/lib/eventemitter2.min.js">
		</script>
		<script
				type="text/javascript" src="https://static.robotwebtools.org/mjpegcanvasjs/current/mjpegcanvas.min.js">
		</script>
	</head>

	<body>
		<div id="app" class="container">
			<div class="jumbotron">
				<h1>Hello from ROSDS!</h1>
			</div>

			<div class="row" style="max-height:200px;">
				<div class="col-md-6">
					<h3>Connection status</h3>

					<p class="text-success">Connected!</p>
					<p class="text-danger">Not connected!</p>

					<label>Websocket server address</label>
					<input type="text" />
					<br />
					<button class="btn btn-danger">Disconnect!</button>
					<button class="btn btn-success">Connect!</button>
				</div>
				<div class="col-md-6" style="max-height:200px; overflow:auto;">
					<h3>Log messages</h3>
					<div>
					</div>
				</div>
			</div>
		</div>
	    	<script type="text/javascript">
			var ros = new ROSLIB.Ros({url : 'ws://localhost:9090/'});
			ros.on('connection', function() { console.log('Connected to websocket server.');});

			ros.on('error', function(error) { console.log('Error connecting to websocket server: ', error);});

			ros.on('close', function() { console.log('Connection to websocket server closed.');});
	    		var cmdVel = new ROSLIB.Topic({
			    ros : ros,
			    name : 'turtle1/cmd_vel',
			    messageType : 'geometry_msgs/Twist'
			});

var cmdVel2 = new ROSLIB.Topic({
			    ros : ros,
			    name : '/cmd_vel',
			    messageType : 'geometry_msgs/Twist'
			});
			
	document.onkeydown = checkKey;

	function checkKey(e) {

	    e = e || window.event;

	    if (e.keyCode == '38') {
		// up arrow
		var twist = new ROSLIB.Message({
					    linear : {
						x : 2.0,
						y : 0.0,
						z : 0.0
					    },
					    angular : {
						x : 0.0,
						y : 0.0,
						z : 0.0
					    }
		});
	    }
	    else if (e.keyCode == '40') {
// down arrow
		var twist = new ROSLIB.Message({
				    linear : {
					x : -2.0,
					y : 0.0,
					z : 0.0
				    },
				    angular : {
					x : 0.0,
					y : 0.0,
					z : 0.0
				    }
		});
	    }
	    else if (e.keyCode == '37') {
	       // left arrow

		var twist = new ROSLIB.Message({
				    linear : {
					x : 0.0,
					y : -1.0,
					z : 0.0
				    },
				    angular : {
					x : 0.0,
					y : 0.0,
					z : 2.0
				    }
		});
	    }
	    else if (e.keyCode == '39') {
	       // right 
		var twist = new ROSLIB.Message({
				    linear : {
					x : 0.0,
					y : 0.0,
					z : 0.0
				    },
				    angular : {
					x : 0.0,
					y : 0.0,
					z : -2.0
				    }
				});
	    	}

		this.ros.on('connection', () => {
			this.logs.unshift((new Date()).toTimeString() + ' - Connected!')
			this.connected = true
			this.loading = false
			this.setCamera()
		})
	cmdVel.publish(twist);
cmdVel2.publish(twist);
	}





	///stream
			setCamera: function() {
				console.log('set camera method')
				this.cameraViewer = new MJPEGCANVAS.Viewer({
					divID: 'mjpeg',
					//host: '54.167.21.209',
					host: '192.168.178.22',
					width: 640,
					height: 480,
					topic: '/camera/rgb/image_raw',
					port: 11315,
				});

				this.ros.on('connection', () => {
					this.logs.unshift((new Date()).toTimeString() + ' - Connected!')
					this.connected = true
					this.loading = false
					this.setCamera()
				})
			}
			
		</script>
			<div class="row">
				<div class="col-md-6 row">
					<div class="col-md-12 text-center">
						<h5>Commands</h5>
					</div>

					<!-- 1st row -->
					<div class="col-md-12 text-center">
						<button @click="forward" :disabled="loading || !connected" class="btn btn-primary">Go straight</button>
						<br><br>
					</div>

					<!-- 2nd row -->
					<div class="col-md-4 text-center">
						<button @click="turnLeft" :disabled="loading || !connected" class="btn btn-primary">Turn left</button>
					</div>
					<div class="col-md-4 text-center">
						<br>
						<button @click="stop" :disabled="loading || !connected" class="btn btn-danger">Stop</button>
						<br>
						<br>
					</div>
					<div class="col-md-4 text-center">
						<button @click="turnRight" :disabled="loading || !connected" class="btn btn-primary">Turn right</button>
					</div>

					<!-- 3rd row -->
					<div class="col-md-12 text-center">
						<button @click="backward" :disabled="loading || !connected" class="btn btn-primary">Go straight</button>
					</div>
				</div>

				<div class="col-md-6">
					<div id="mjpeg"></div>
				</div>
			</div>

			</div>
	</body>
</html>
